CGIScaler Installation
======================
Jakub Pastuszek <jpastuszek@gmail.com>
v2.0, June 2008

Installation using CCMake
-------------------------

Untar and go to your source directory
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-----------------------------------
tar xjf CGIScaler-<varsion>.tar.bz2
cd CGIScaler-<version>
-----------------------------------

Configure with CCMake
~~~~~~~~~~~~~~~~~~~~~
--------
ccmake .
--------
Make sure that _ImageMagick_ include dir and libs are correct.
Also remember to set *CMAKE_BUILD_TYPE* field (us arrow key to navigate, enter to change field - there are some tips at the bottom of the window)

Build
~~~~~
----
make
----

Copy binary to your installaction directory
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The binary could be found in *src* directory and called *cgiscaler* by default.

Create new bash script in your cgi-bin directory
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Use something like that:
-------------------------------------
#!/bin/sh

<path_to_cgiscaler_binary> <switches>
-------------------------------------
This way you can configure CGIScaler runtime (see *--help* switch first)

You can optionally prelink your executable (it will load faster)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-------------------------------------------
prelink --random <path_to_cgiscaler_binary>
-------------------------------------------

Apache Configuration
--------------------

Add something this to your *vhost/httpd.conf* to serve your thumbnails under _http://your.domain/photo/_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
-----------------------------------------------------------
ScriptAlias "/photo" "/var/www/localhost/cgi-bin/cgiscaler"
-----------------------------------------------------------

Non standard library path (usefull with own IM builds or Solaris + 64bit build)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Add SetEnv to your config, e.x.:
-----------------------------------------------------------------------------------
SetEnv LD_LIBRARY_PATH "/usr/local/lib/64:/usr/local/lib:/usr/lib:$LD_LIBRARY_PATH"
-----------------------------------------------------------------------------------

Reload Apache
~~~~~~~~~~~~~
-------------------------
/etc/init.d/apache reload
-------------------------

Try it!
~~~~~~~
Hit:
---------------------------------------------------
http://your.domain/photo/some_image.jpg?w=122&h=200
---------------------------------------------------

Performance tips
----------------

Build IM with Q8
~~~~~~~~~~~~~~~~
   ImageMagick can be built witch different quantum depths.
   For thumbnailing purposes there is no need to use quantum depth > 8.
   Bigger quantym depth = higher memory usage, lower speed (more data transferred, bigger work set)

For some performance test you can use:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
------------------------------------------------------------------------------------------------------------
httperf --server scaler --num-conn 1000 --ra 200 --timeout 50 --uri=/photo/quick_gimp_pattern_test.png?w=222
------------------------------------------------------------------------------------------------------------
